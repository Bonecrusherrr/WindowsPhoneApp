if (window.performance && window.performance.mark) { window.performance.mark('startLoadBundleInner-async'); }
// Copyright (C) Microsoft Corporation. All rights reserved.
define("Gallery/Client/Service/SearchProvider/VSSGallerySearchProvider",["require","exports","Gallery/Client/Service/VSSGallery/VSSGallery","VSS/Utils/String","Gallery/Client/Service/VSSItem","VSS/Utils/Array","Gallery/Client/Common/Constants","VSS/FeatureAvailability/Services","VSS/Gallery/Contracts","Gallery/Scripts/Gallery/Resources/VSS.Resources.Gallery","Gallery/Scripts/Gallery/Resources/VSS.Resources.GalleryCommon"],function(n,t,i,r,u,f,e,o,s,h,c){var l=function(){function n(){this._vssGallery=new i.VSSGallery}return n.prototype.searchWithParameters=function(n,t,i,r,u,f){var e=this._writeSearchOptions(n,t,i,r);this.search(e,u,f)},n.prototype.search=function(n,t,i){n&&this._vssGallery.searchItems(n).then(function(n){var i={searchResults:n.items,totalCount:n.totalCount,categoryInfo:n.categoryInfo};t(i)},function(n){i(n)})},n.prototype._writeSearchOptions=function(n,t,i,r){var o=n.pricing,h=s.PublishedExtensionFlags.None,f=s.PublishedExtensionFlags.None;if(o)switch(o){case e.FilterConstants.CostParamValueFree:h=s.PublishedExtensionFlags.Paid|s.PublishedExtensionFlags.Trial;break;case e.FilterConstants.CostParamValuePaid:f=s.PublishedExtensionFlags.Paid;break;case e.FilterConstants.CostParamValueTrial:f=s.PublishedExtensionFlags.Trial}var l=n.category,u=this._getTargetsAndVersion(n),c={searchTerm:this._getSearchQuery(n,u.installationTargets),pageNumber:t,pageSize:i,installationTargets:u.installationTargets,categories:this._populateCategories(n),sortBy:r,excludeFlags:h,includeFlags:f,tags:null};return u.versionRange&&(c.versionRange=u.versionRange),c},n.prototype._populateCategories=function(n){var r=[],u=n.category,t=n.subCategory,i;return u!==c.AllCategoriesText&&(i=u,t&&t!==h.AllSubCategoryLabel&&(i+="/"+t),r.push(i)),r},n.prototype._getSearchQuery=function(n,t){if(n.isHosted){var i="";return n.searchQuery?i=n.searchQuery:t.forEach(function(n){i+='target:"'+n+'" '}),i}return null},n.prototype._getTargetsAndVersion=function(n){var i={installationTargets:[],versionRange:null},h;if(r.ignoreCaseComparer(n.product,e.SearchConstants.VSTSProductText)===0)h=n.installationTarget,i.installationTargets=h&&h===e.FilterConstants.InstallationTargetParamValueOnPrem?[u.ItemConstants.INSTALLATION_TARGET_EXTENSION,u.ItemConstants.INSTALLATION_TARGET_TFSEXTENSION,u.ItemConstants.INSTALLATION_TARGET_TFSINTEGRATION,u.ItemConstants.INSTALLATION_TARGET_INTEGRATION]:h&&h===e.FilterConstants.InstallationTargetParamValueCloud?[u.ItemConstants.INSTALLATION_TARGET_EXTENSION,u.ItemConstants.INSTALLATION_TARGET_INTEGRATION,u.ItemConstants.INSTALLATION_TARGET_HOSTED_EXTENSION,u.ItemConstants.INSTALLATION_TARGET_HOSTED_INTEGRATION,u.ItemConstants.INSTALLATION_TARGET_HOSTED_RESOURCE]:[u.ItemConstants.INSTALLATION_TARGET_EXTENSION,u.ItemConstants.INSTALLATION_TARGET_INTEGRATION,u.ItemConstants.INSTALLATION_TARGET_HOSTED_EXTENSION,u.ItemConstants.INSTALLATION_TARGET_TFSEXTENSION,u.ItemConstants.INSTALLATION_TARGET_TFSINTEGRATION,u.ItemConstants.INSTALLATION_TARGET_HOSTED_INTEGRATION,u.ItemConstants.INSTALLATION_TARGET_HOSTED_RESOURCE];else if(r.ignoreCaseComparer(n.product,e.SearchConstants.VSCodeProductText)===0)i.installationTargets=[u.ItemConstants.INSTALLATION_TARGET_CODE];else if(r.ignoreCaseComparer(n.product,e.SearchConstants.VSProductText)===0){var s=n.vsVersion,c=o.FeatureAvailabilityService.isFeatureEnabled(e.FeatureFlag.EnableVersionRangeOnSearchPage),t=null;s?(f.contains(s,e.FilterConstants.VersionParamValueVS2010)?t="2010":f.contains(s,e.FilterConstants.VersionParamValueVS2012)?t="2012":f.contains(s,e.FilterConstants.VersionParamValueVS2013)?t="2013":f.contains(s,e.FilterConstants.VersionParamValueVS2015)?t="2015":f.contains(s,e.FilterConstants.VersionParamValueVS15)?t="2017":i.installationTargets=[u.ItemConstants.INSTALLATION_TARGET_VS_IDE],t&&(i.installationTargets=u.InstallationTargetToVSIdeMapping.getInstallationTargetsFromIdeVersion(t,c),c&&(i.versionRange=u.InstallationTargetToVSIdeMapping.getInstallationTargetVersionRangeFromIdeYear(t)))):i.installationTargets=[u.ItemConstants.INSTALLATION_TARGET_VS_IDE]}return i},n}();t.VSSGallerySearchProvider=l});
define("Gallery/Client/Service/VNext/SearchProviderAbstractions",["require","exports","q","Gallery/Client/Common/Constants","Gallery/Client/Service/VNext/GalleryDataProvider","Gallery/Scripts/Gallery/Resources/VSS.Resources.GalleryCommon","Gallery/Client/Service/ItemsConverter","Gallery/Client/Service/VSSGallery/IVSSGallery","Gallery/Client/Service/VSSItem","Gallery/Client/Service/SearchProvider/VSSGallerySearchProvider"],function(n,t,i,r,u,f,e,o,s,h){var c=function(){function n(){}return n._getVSSSearchProvider=function(){return n._vssSearchProvider||(n._vssSearchProvider=new h.VSSGallerySearchProvider),n._vssSearchProvider},n.GetExtensionsData=function(n){var p=this,l=i.defer(),h,c,a=[],t,v=e.PublishedExtensionFlags.None,y=e.PublishedExtensionFlags.None;return n.tab===1?(this.category=n.category.replace("vsts_",""),c=[s.ItemConstants.INSTALLATION_TARGET_EXTENSION,s.ItemConstants.INSTALLATION_TARGET_INTEGRATION,s.ItemConstants.INSTALLATION_TARGET_HOSTED_EXTENSION,s.ItemConstants.INSTALLATION_TARGET_TFSEXTENSION,s.ItemConstants.INSTALLATION_TARGET_TFSINTEGRATION,s.ItemConstants.INSTALLATION_TARGET_HOSTED_INTEGRATION]):n.tab===2?(this.category=n.category.replace("vscode_",""),c=[s.ItemConstants.INSTALLATION_TARGET_CODE]):n.tab===0&&(this.category=n.category.replace("vs_",""),c=[s.ItemConstants.INSTALLATION_TARGET_VS_IDE]),this.category===f.MostPopular_Items_Header?t=o.VSSSortByValue.Downloads:this.category===f.TopPaid_Items_Header?(t=o.VSSSortByValue.Downloads,y=e.PublishedExtensionFlags.Paid):this.category===f.TopFree_Items_Header?(t=o.VSSSortByValue.Downloads,v=e.PublishedExtensionFlags.Paid):this.category===f.HighestRated_Items_Header?t=o.VSSSortByValue.AverageRating:this.category===f.RecentlyAdded?t=u.GalleryDataProvider.deploymentIsHosted()?o.VSSSortByValue.ReleaseDate:o.VSSSortByValue.PublishedDate:this.category===r.TrendingCategoryConstants.TrendingWeekly?t=o.VSSSortByValue.TrendingWeekly:this.category===r.TrendingCategoryConstants.TrendingDaily?t=o.VSSSortByValue.TrendingDaily:this.category===r.TrendingCategoryConstants.TrendingMonthly?t=o.VSSSortByValue.TrendingMonthly:(a=[this.category],t=o.VSSSortByValue.Downloads),h={searchTerm:"",pageNumber:n.currentPageNumber,pageSize:n.pageSize,installationTargets:c,categories:a,sortBy:t,excludeFlags:v,includeFlags:y},this._getVSSSearchProvider().search(h,function(n){(h.sortBy===o.VSSSortByValue.TrendingWeekly||h.sortBy===o.VSSSortByValue.TrendingDaily||h.sortBy===o.VSSSortByValue.TrendingMonthly)&&(n.searchResults=p.filterTrendingCategoryExtensions(n.searchResults,h.sortBy));l.resolve(n)},function(n){l.reject(n)}),l.promise},n.filterTrendingCategoryExtensions=function(n,t){return t===o.VSSSortByValue.TrendingWeekly?n.filter(function(n){return n.trendingWeekly>0}):t===o.VSSSortByValue.TrendingDaily?n.filter(function(n){return n.trendingDaily>0}):n.filter(function(n){return n.trendingMonthly>0})},n}();c._vssSearchProvider=null;c.category="";t.VSSSearchProviderAbstraction=c});
if (window.performance && window.performance.mark) { window.performance.mark('endLoadBundleInner-async'); }